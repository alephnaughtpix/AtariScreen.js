function AtariScreen(C,G,Q,D){function H(){var a=h.getContext("2d");z?(h.width=640,h.height=400,a.setTransform(1,0,0,1,0,0),a.scale(A,B),a.imageSmoothingEnabled=!1):(h.width=p,h.height=r);return a}function E(a){a="undefined"===typeof a?0:a;a=0>a||2<a?0:a;switch(a){case 0:m=4;B=A=2;p=320;r=200;n=new Uint16Array([4095,3840,240,4080,15,3855,255,1365,819,3891,1011,4083,831,3903,1023,0]);w(n);break;case 1:m=2;A=1;B=2;p=640;r=200;n=new Uint16Array([4095,3840,240,0]);w(n);break;case 2:B=A=m=1,p=640,r=400,
n=new Uint16Array([0,4095]),w(n)}var b=H();b.fillStyle=q[0];b.fillRect(0,0,p,r);return I=a}function J(){if(x){x=!1;var a=H(),b=a.createImageData(p,r),c=t.length/m,d=0,e=0,F,k,y,u,g,l=Array(m);for(F=0;F<c;F++){for(k=0;k<m;k++)l[k]=t[e++];for(k=15;-1<k;--k){u=0;g=1<<k;for(y=0;y<m;y++)l[y]&g&&(u+=1<<y);b.data[d++]=f[u][0];b.data[d++]=f[u][1];b.data[d++]=f[u][2];b.data[d++]=255}}a.putImageData(b,0,0);z&&a.drawImage(h,0,0);x=!0}return x}function w(a){var b=a.length;v=Array(b);q=Array(b);f=Array(b);g=Array(b);
for(var c=0;c<b;c++)K(c,a[c]);this.palette=v;this.pixel_palette=f;this.canvas_palette=q}function K(a,b){var c=(((b&1792)>>7)+((b&2048)>>11)).toString(16),d=(((b&112)>>3)+((b&128)>>7)).toString(16),e=(((b&7)<<1)+((b&8)>>3)).toString(16);v[a]=b;q[a]="#"+c+c+d+d+e+e;f[a]=[parseInt(c+c,16),parseInt(d+d,16),parseInt(e+e,16)]}function L(a,b){for(var c=v.length,d=new Uint16Array(c),e=0;e<c;e++)d[e]=a.getUint16(b),b+=2;w(d)}function M(a,b){for(var c=t.length,d=0;d<c;d++)t[d]=a.getUint16(b),b+=2;return b}
function N(a,b){var c=160/m,d=c/2,e,f,k,g,h,l,p;e=new ArrayBuffer(160);var n=new DataView(e),q=0;for(e=0;e<r;e++){for(f=g=0;f<m;f++)for(h=0;h<c;)if(l=a.getUint8(b++),0<(l&128))for(p=256-l+1,l=a.getUint8(b++),k=0;k<p;k++)n.setUint8(g++,l),h++;else for(l++,k=0;k<l;k++)n.setUint8(g++,a.getUint8(b++)),h++;for(f=g=0;f<d;f++){for(k=0;k<m;k++)t[q+k]=n.getUint16(g+k*c);g+=2;q+=m}}return b}function O(a){var b=!1;if(0<=a&&3>=a){var c=l[a];if(c.on){a=b=c.left_colour;var d=c.right_colour,e=c.position,e=e-c.direction;
e>d&&(e=a);e<a&&(e=d);c.position=e;for(var c=c.length,h=0;h<c;h++)e>d&&(e=b),f[a++]=[g[e][0],g[e][1],g[e++][2]];b=!0}}return b}function P(a){var b=-1;if(0<=a&&3>=a){var c=l[a];0!=c.direction&&(b=c.animationId=setInterval(function(){O(a);requestAnimFrame(function(){J()})},c.delay),c.animating=!0)}return b}void 0===D&&(D=!0);var v,q,f,g,p,r,I,m,A,B,n,z=D,x=!0,t=new Uint16Array(16E3),l=[],h=G.appendChild(document.createElement("canvas"));h.id=Q;h.width=640;h.height=400;this.width=function(){return p};
this.height=function(){return r};this.planes=function(){return m};this.mode=function(){return I};this.ready=function(){return x};this.cycles=l;this.canvas=h;Object.defineProperties(this,{scale:{get:function(){return z},set:function(a){z=a}},default_palette:{get:function(){return n}},palette:{get:function(){return v},set:function(a){v=a}},canvas_palette:{get:function(){return q},set:function(a){q=a}},pixel_palette:{get:function(){return f},set:function(a){f=a}},screen_memory:{get:function(){return t},
set:function(a){t=a}}});this.SetMode=E;this.Display=J;this.SetPalette=w;this.SetPaletteValue=K;this.ExtractDegasElite=function(a){var b=new DataView(a),c=b.getUint16(0);E(c&255);L(b,2);c=0<(c&32768)?N(b,34):M(b,34);if(32==a.byteLength-c){l=[];for(a=0;4>a;a++){var d={};d.left_colour=b.getUint16(c+2*a);d.right_colour=b.getUint16(c+2*a+8);d.direction=b.getUint16(c+2*a+16)-1;d.delay=Math.round(1E3*(128-b.getUint16(c+2*a+24))/60);d.position=0;d.length=d.right_colour-d.left_colour+1;d.on=!1;d.animating=
!1;l.push(d)}this.cycles=l}};this.ExtractPalette=L;this.ExtractPlanarScreen=M;this.ExtractRLEData=N;this.StartCycle=function(a,b){void 0===b&&(b=!1);var c=!1;if(0<=a&&3>=a){var d=l[a];if(0!=d.direction){c=f.length;g=Array(c);for(var e=0;e<c;e++)g[e]=[f[e][0],f[e][1],f[e][2]];d.position=0;d.length=d.right_colour-d.left_colour+1;d.on=!0;b&&P(a);c=!0}}return c};this.GetNextCycle=O;this.StartCycleAnimation=P;this.StopCycle=function(a){var b=!1;if(0<=a&&3>=a&&(a=l[a],a.on)){a.animating&&clearInterval(a.animationId);
a.animating=!1;b=g.length;f=Array(b);for(var c=0;c<b;c++)f[c]=[g[c][0],g[c][1],g[c][2]];a.on=!1;b=!0}return b};this.Show=function(){h.style.visibility="visible"};this.Hide=function(){h.style.visibility="hidden"};E(C)}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(C,G){window.setTimeout(C,1E3/60)}}();